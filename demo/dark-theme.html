<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>sl-vue-tree</title>
    <link rel="stylesheet" href="../dist/sl-vue-tree-dark.css">
    <link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
    <script src="../dist/sl-vue-tree.js"></script>
</head>
<body>

<div id="app" @click="contextMenuIsVisible = false">

    <h2> Sl-vue-tree - custom dark theme and events handlers</h2>

    <a href="./dark-theme.html" target="_blank">Source code</a>
    <br><br>


    <div class="last-event row">
        Last event: {{ lastEvent }}
    </div>

    <div class="row">
        <div class="tree-container">
            <sl-vue-tree
                    v-model="nodes"
                    ref="slVueTree"
                    :allow-multiselect="false"
                    @select="nodeSelected"
                    @drop="nodeDropped"
                    @toggle="nodeToggled"
                    @nodecontextmenu="showContextMenu"
                    :could-be-child="couldBeChild"
            >

                <template slot="title" slot-scope="{ node }">
          <span class="item-icon">
            <i class="fa fa-file" v-if="node.isLeaf"></i>
            <i class="fa fa-folder" v-if="!node.isLeaf"></i>
          </span>

                    {{ node.title }}
                </template>


                <template slot="toggle" slot-scope="{ node }">
          <span v-if="!node.isLeaf">
            <i v-if="node.isExpanded" class="fa fa-chevron-down"></i>
            <i v-if="!node.isExpanded" class="fa fa-chevron-right"></i>
          </span>
                </template>


                <template slot="sidebar" slot-scope="{ node }">
          <span class="visible-icon" @click="event => toggleVisibility(event, node)">
            <i v-if="!node.data || node.data.visible !== false" class="fa fa-eye"></i>
            <i v-if="node.data && node.data.visible === false" class="fa fa-eye-slash"></i>
          </span>
                </template>


                <template slot="draginfo" slot-scope="{ nodes, cursorPosition}">
                    {{ couldBeChildInfo(nodes, cursorPosition) }}
                </template>

            </sl-vue-tree>
        </div>
    </div>


</div>

<script>

  var nodes = [{
    "title": "home",
    "isLeaf": false,
    "isSelectable": false,
    "isDraggable": false,
    "data": {
      "active": true,
      "links": {
        "add": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_parent=24&addprotothemeeditor_molecule&id_root=24",
        "update": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=24&updateprotothemeeditor_molecule",
        "delete": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=24&deleteprotothemeeditor_molecule",
        "view": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=24&viewprotothemeeditor_molecule"
      },
      "icon": "/modules/protothemeeditor/views/img/types/container.svg",
      "label": "Container",
      "type": "container",
      "id": 24,
      "idParent": null,
      "childrenTypes": ["row"]
    },
    "isExpanded": true,
    "children": [{
      "title": "row_home",
      "isLeaf": false,
      "isSelectable": true,
      "isDraggable": true,
      "data": {
        "active": true,
        "links": {
          "add": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_parent=25&addprotothemeeditor_molecule&id_root=24",
          "update": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=25&updateprotothemeeditor_molecule",
          "delete": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=25&deleteprotothemeeditor_molecule",
          "view": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=25&viewprotothemeeditor_molecule"
        },
        "icon": "/modules/protothemeeditor/views/img/types/row.svg",
        "label": "Ligne",
        "type": "row",
        "id": 25,
        "idParent": 24,
        "childrenTypes": ["col"]
      },
      "isExpanded": true,
      "children": [{
        "title": "12/12 (taille normale)", "isLeaf": false, "isSelectable": true, "isDraggable": true, "data": {
          "active": true,
          "links": {
            "add": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_parent=26&addprotothemeeditor_molecule&id_root=24",
            "update": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=26&updateprotothemeeditor_molecule",
            "delete": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=26&deleteprotothemeeditor_molecule",
            "view": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=26&viewprotothemeeditor_molecule"
          },
          "icon": "/modules/protothemeeditor/views/img/types/default.svg",
          "label": "Colonne",
          "type": "col",
          "id": 26,
          "idParent": 25,
          "childrenTypes": ["accordeon", "alert", "banner", "carousel", "container", "html_content", "dropdown", "funnel_link", "image", "interstitial", "link", "row", "blog_post_list", "category_list", "link_list", "manufacturer_list", "custom_list", "product_list", "megamenu", "mobile_menu", "category_miniature", "product_miniature", "modal", "tabjs", "separator", "title", "topic_link", "video", "widget", "common_widget"]
        }, "isExpanded": true, "children": [{
          "title": "carousel_27",
          "isLeaf": false,
          "isSelectable": true,
          "isDraggable": true,
          "data": {
            "active": true,
            "links": {
              "add": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_parent=27&addprotothemeeditor_molecule&id_root=24",
              "update": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=27&updateprotothemeeditor_molecule",
              "delete": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=27&deleteprotothemeeditor_molecule",
              "view": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=27&viewprotothemeeditor_molecule"
            },
            "icon": "/modules/protothemeeditor/views/img/types/carousel.svg",
            "label": "Carrousel",
            "type": "carousel",
            "id": 27,
            "idParent": 26,
            "childrenTypes": ["carousel_slide"]
          },
          "isExpanded": true,
          "children": [{
            "title": "Flexible Atomic Suite",
            "isLeaf": true,
            "isSelectable": true,
            "isDraggable": true,
            "data": {
              "active": true,
              "links": {
                "add": null,
                "update": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=28&updateprotothemeeditor_molecule",
                "delete": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=28&deleteprotothemeeditor_molecule",
                "view": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=28&viewprotothemeeditor_molecule"
              },
              "icon": "/modules/protothemeeditor/views/img/types/default.svg",
              "label": "Slide",
              "type": "carousel_slide",
              "id": 28,
              "idParent": 27,
              "childrenTypes": []
            }
          }, {
            "title": "Efficience",
            "isLeaf": true,
            "isSelectable": true,
            "isDraggable": true,
            "data": {
              "active": true,
              "links": {
                "add": null,
                "update": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=29&updateprotothemeeditor_molecule",
                "delete": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=29&deleteprotothemeeditor_molecule",
                "view": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=29&viewprotothemeeditor_molecule"
              },
              "icon": "/modules/protothemeeditor/views/img/types/default.svg",
              "label": "Slide",
              "type": "carousel_slide",
              "id": 29,
              "idParent": 27,
              "childrenTypes": []
            }
          }]
        }, {
          "title": "Produits sur mesure",
          "isLeaf": true,
          "isSelectable": true,
          "isDraggable": true,
          "data": {
            "active": true,
            "links": {
              "add": null,
              "update": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=30&updateprotothemeeditor_molecule",
              "delete": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=30&deleteprotothemeeditor_molecule",
              "view": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=30&viewprotothemeeditor_molecule"
            },
            "icon": "/modules/protothemeeditor/views/img/types/title.svg",
            "label": "Titre",
            "type": "title",
            "id": 30,
            "idParent": 26,
            "childrenTypes": []
          }
        }, {
          "title": "Sélection manuelle de produits",
          "isLeaf": true,
          "isSelectable": true,
          "isDraggable": true,
          "data": {
            "active": true,
            "links": {
              "add": null,
              "update": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=31&updateprotothemeeditor_molecule",
              "delete": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=31&deleteprotothemeeditor_molecule",
              "view": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=31&viewprotothemeeditor_molecule"
            },
            "icon": "/modules/protothemeeditor/views/img/types/product_list.svg",
            "label": "Liste de produits",
            "type": "product_list",
            "id": 31,
            "idParent": 26,
            "childrenTypes": []
          }
        }, {
          "title": "Catégories populaires",
          "isLeaf": true,
          "isSelectable": true,
          "isDraggable": true,
          "data": {
            "active": true,
            "links": {
              "add": null,
              "update": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=32&updateprotothemeeditor_molecule",
              "delete": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=32&deleteprotothemeeditor_molecule",
              "view": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=32&viewprotothemeeditor_molecule"
            },
            "icon": "/modules/protothemeeditor/views/img/types/title.svg",
            "label": "Titre",
            "type": "title",
            "id": 32,
            "idParent": 26,
            "childrenTypes": []
          }
        }, {
          "title": "ID: 3, 4, 5, 6, 7, 8",
          "isLeaf": true,
          "isSelectable": true,
          "isDraggable": true,
          "data": {
            "active": true,
            "links": {
              "add": null,
              "update": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=33&updateprotothemeeditor_molecule",
              "delete": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=33&deleteprotothemeeditor_molecule",
              "view": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=33&viewprotothemeeditor_molecule"
            },
            "icon": "/modules/protothemeeditor/views/img/types/category_list.svg",
            "label": "Liste de catégories",
            "type": "category_list",
            "id": 33,
            "idParent": 26,
            "childrenTypes": []
          }
        }, {
          "title": " Toutes les categories  keyboard_arrow_right  ",
          "isLeaf": true,
          "isSelectable": true,
          "isDraggable": true,
          "data": {
            "active": true,
            "links": {
              "add": null,
              "update": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=34&updateprotothemeeditor_molecule",
              "delete": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=34&deleteprotothemeeditor_molecule",
              "view": "https://prestashop178.denys.tot/bb/index.php?controller=AdminProtothemeeditorLocationMolecule&token=2df320a8d017cd4713eda359e69d6ed9&id_molecule=34&viewprotothemeeditor_molecule"
            },
            "icon": "/modules/protothemeeditor/views/img/types/html_content.svg",
            "label": "Contenu HTML",
            "type": "html_content",
            "id": 34,
            "idParent": 26,
            "childrenTypes": []
          }
        }]
      }]
    }]
  }];

  new Vue({
    el: '#app',
    components: {SlVueTree},
    data: function () {
      return {
        nodes: nodes,
        contextMenuIsVisible: false,
        lastEvent: 'No last event',
        selectedNodesTitle: '',
      }
    },

    mounted() {
      // expose instance to the global namespace
      window.slVueTree = this.$refs.slVueTree;
    },

    methods: {
      couldBeChild(selectedNode, cursorPosition) {
        return this.couldBeChildInfo([selectedNode], cursorPosition);
      },
      couldBeChildInfo(nodes, cursorPosition) {
        if (nodes.length === 0 || !cursorPosition) {
          return '';
        }

        const tree = this.$refs.slVueTree;
        const currentTarget = nodes[0];
        const canBeReplaced = !tree.checkNodeIsParent(currentTarget, cursorPosition.node);
        const positionRule = !(cursorPosition.node.level === 1 && (['after', 'before'].includes(cursorPosition.placement)))
        console.log(canBeReplaced);
        console.log(positionRule);
        return canBeReplaced && positionRule;
      },

      toggleVisibility: function (event, node) {
        const slVueTree = this.$refs.slVueTree;
        event.stopPropagation();
        const visible = !node.data || node.data.visible !== false;
        slVueTree.updateNode(node.path, {data: {visible: !visible}});
        this.lastEvent = `Node ${node.title} is ${visible ? 'visible' : 'invisible'} now`;
      },

      nodeSelected(nodes, event) {
        this.selectedNodesTitle = nodes.map(node => node.title).join(', ');
        this.lastEvent = `Select nodes: ${this.selectedNodesTitle}`;
      },

      nodeToggled(node, event) {
        this.lastEvent = `Node ${node.title} is ${node.isExpanded ? 'expanded' : 'collapsed'}`;
      },

      nodeDropped(nodes, position, event) {
        this.lastEvent = `Nodes: ${nodes.map(node => node.title).join(', ')} are dropped ${position.placement} ${position.node.title}`;
      },

      showContextMenu(node, event) {
        event.preventDefault();
        this.contextMenuIsVisible = true;
        const $contextMenu = this.$refs.contextmenu;
        $contextMenu.style.left = event.clientX + 'px';
        $contextMenu.style.top = event.clientY + 'px';
      },

      removeNode() {
        this.contextMenuIsVisible = false;
        const $slVueTree = this.$refs.slVueTree;
        const paths = $slVueTree.getSelected().map(node => node.path);
        $slVueTree.remove(paths);
      }
    }
  })
</script>

<style>

    body {
        background: #050d12;
        font-family: Arial;
        color: rgba(255, 255, 255, 0.5);
    }

    a {
        color: #bbb;
    }

    .row {
        display: flex;
        margin-bottom: 10px;
    }

    .contextmenu {
        position: absolute;
        background-color: white;
        color: black;
        border-radius: 2px;
        cursor: pointer;
    }

    .contextmenu > div {
        padding: 10px;
    }

    .contextmenu > div:hover {
        background-color: rgba(100, 100, 255, 0.5);
    }


    .last-event {
        color: white;
        background-color: rgba(100, 100, 255, 0.5);
        padding: 10px;
        border-radius: 2px;
    }

    .tree-container {
        flex-grow: 1;
    }

    .sl-vue-tree.sl-vue-tree-root {
        flex-grow: 1;
        overflow-x: hidden;
        overflow-y: auto;
        height: 300px;
    }


    .json-preview {
        flex-grow: 1;
        margin-left: 10px;
        background-color: #13242d;
        border: 1px solid black;
        padding: 10px;
    }

    .item-icon {
        display: inline-block;
        text-align: left;
        width: 20px;
    }


</style>

</body>
</html>
